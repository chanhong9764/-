-- 코드를 입력하세요
SELECT C.CAR_ID, C.CAR_TYPE, (C.DAILY_FEE - (C.DAILY_FEE * (SUBSTR(D.DISCOUNT_RATE, 1) * 0.01))) * 30 AS FEE
FROM CAR_RENTAL_COMPANY_CAR AS C
JOIN CAR_RENTAL_COMPANY_DISCOUNT_PLAN AS D
ON C.CAR_TYPE = D.CAR_TYPE
WHERE CAR_ID NOT IN (
    SELECT DISTINCT CAR_ID
    FROM CAR_RENTAL_COMPANY_RENTAL_HISTORY 
    WHERE ((END_DATE BETWEEN '2022-11-01 00:00:00' 
             AND '2022-11-30 00:00:00') 
            OR (START_DATE BETWEEN '2022-11-01 00:00:00' 
                AND '2022-11-30 00:00:00')) 
     OR (START_DATE <'2022-11-01 00:00:00' 
         AND END_DATE>'2022-11-30 00:00:00')
)
AND C.CAR_TYPE IN ('세단', 'SUV')
AND DURATION_TYPE = '30일 이상' 
AND (C.DAILY_FEE - (C.DAILY_FEE * (SUBSTR(D.DISCOUNT_RATE, 1) * 0.01))) * 30 BETWEEN 500000 AND 2000000
ORDER BY FEE DESC, C.CAR_TYPE ASC, C.CAR_ID DESC